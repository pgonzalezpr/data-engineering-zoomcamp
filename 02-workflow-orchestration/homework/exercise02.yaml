id: exercise_02_yearly_count_single_cmd
namespace: zoomcamp
description: |
  Count total number of rows across all NYC taxi CSVs for a given year
  using a single shell command

inputs:
  - id: taxi
    type: SELECT
    displayName: Select taxi type
    values: [yellow, green]
    defaults: yellow

  - id: year
    type: SELECT
    displayName: Select year
    values: ["2019", "2020"]
    defaults: "2019"

tasks:
  - id: count_all_rows
    type: io.kestra.plugin.scripts.shell.Commands
    commands:
      - |
        TOTAL=0
        for MONTH in 01 02 03 04 05 06 07 08 09 10 11 12; do
          FILE={{inputs.taxi}}_tripdata_{{inputs.year}}-$MONTH.csv
          echo "Processing $FILE"
          ROWS=$(wget -qO- https://github.com/DataTalksClub/nyc-tlc-data/releases/download/{{inputs.taxi}}/$FILE.gz \
            | gunzip \
            | wc -l)
          ROWS=$((ROWS - 1))   # subtract header
          echo "  $MONTH â†’ $ROWS rows"
          TOTAL=$((TOTAL + ROWS))
        done
        echo "=============================="
        echo "TOTAL ROWS FOR {{inputs.year}} ({{inputs.taxi}}): $TOTAL"
        echo "=============================="


